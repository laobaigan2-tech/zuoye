# Python 字典详解

## 1. 核心定义

**字典** 是 Python 中一种内置的、可变的数据结构，用于存储 **键-值对** 的集合。它的主要功能是通过一个唯一的 **键** 来高效地查找、添加、修改和删除其关联的 **值**。

你可以把它想象成一个 **真正的字典** 或 **索引表**：通过“词语”（键）快速查到对应的“解释”（值）。

## 2. 关键特征

1.  **键-值对存储**
    *   字典中的每个元素都由两部分组成：一个 **键** 和一个 **值**，中间用冒号 `:` 分隔，合起来称为一个“键-值对”。

2.  **键的唯一性**
    *   字典中的 **键必须是唯一的**。如果同一个键被赋值两次，后一个值会覆盖前一个值。
    *   键必须是 **不可变** 的数据类型，如整数、浮点数、字符串、元组。列表或字典本身不能作为键。

3.  **值的任意性**
    *   与键不同，**值可以是任何数据类型**（数字、字符串、列表，甚至是另一个字典），并且可以重复。

4.  **无序性（Python 3.6+ 后有插入顺序）**
    *   在 Python 3.6 之前，字典中的元素没有明确的顺序。从 Python 3.7 开始，它正式成为语言特性：字典会 **记录键-值对的插入顺序**。但在使用时，主要仍应依赖键来访问，而非位置。

5.  **高效查找**
    *   字典底层基于哈希表实现，这使得通过键来查找、插入或删除值的操作速度非常快，时间复杂度接近 O(1)。

## 3. 简单类比

*   **现实字典**：你想知道“Apple”的意思，你不会从第一页开始逐页查找，而是直接翻到字母“A”开头的部分，找到“Apple”词条，然后阅读它的解释。在这里，“Apple”是 **键**，它的解释就是 **值**。
*   **通讯录**：你想找“张三”的电话号码，你会在手机通讯录里搜索名字“张三”，然后就能看到他的号码。名字“张三”是 **键**，电话号码是 **值**。
*   **学生花名册**：学号（如 `2023001`）是 **键**，学生姓名和相关信息是 **值**。老师通过学号可以快速定位到具体的学生信息。

## 4. 代码示例

```python
# -*- coding: utf-8 -*-
"""
Python 字典基础操作示例
"""

# 1. 创建字典
# 使用花括号 {}，键值对用冒号分隔，不同的键值对用逗号分隔。
student = {
    "name": "小明",
    "age": 18,
    "courses": ["数学", "物理", "英语"],  # 值可以是一个列表
    "id": 1001,
    "is_graduated": False  # 值可以是布尔值
}
print(f"创建字典：{student}")

# 2. 访问值：使用 字典名[键]
print(f"学生姓名：{student['name']}")
print(f"学生年龄：{student['age']}")
print(f"选修课程：{student['courses']}")

# 3. 添加或修改元素
# 如果键不存在，则是添加；如果键已存在，则是修改其值。
student["gender"] = "男"  # 添加新键值对
print(f"添加性别后：{student}")

student["age"] = 19  # 修改已有键的值
print(f"修改年龄后：{student}")

# 4. 删除元素
# 使用 del 语句
del student["is_graduated"]
print(f"删除毕业状态后：{student}")

# 5. 安全地访问值（防止键不存在报错）
# 使用 get(键, 默认值) 方法。如果键不存在，返回默认值（默认为None）。
score = student.get("math_score", 0)  # 获取数学成绩，如果不存在则返回0
print(f"数学成绩（安全获取）：{score}")

# 6. 遍历字典
print("\n遍历字典的键：")
for key in student:  # 等价于 for key in student.keys():
    print(key)

print("\n遍历字典的值：")
for value in student.values():
    print(value)

print("\n遍历字典的键和值：")
for key, value in student.items():  # items() 返回一个包含 (键, 值) 元组的列表
    print(f"键 `{key}` -> 值 `{value}`")

# 7. 检查键是否存在
if "name" in student:
    print(f"\n'name' 键存在于字典中，值为：{student['name']}")
```

## 5. 常见问题

**Q1：字典和列表有什么区别？**

| 特性 | 字典 | 列表 |
| :--- | :--- | :--- |
| **索引方式** | 通过 **任意不可变的键** | 通过 **有序的数字下标 (0, 1, 2...)** |
| **元素顺序** | 3.7+ 后记录插入顺序，但主要靠键访问 | **严格保持插入顺序** |
| **元素要求** | **键必须唯一且不可变**，值任意 | 元素可以是任何类型，可以重复 |
| **主要用途** | 存储需要 **快速通过唯一标识查找** 的数据 | 存储 **有序的、同类型或不同类型** 的数据集合 |

**Q2：当我用不存在的键去访问字典时，为什么会报 `KeyError`？如何处理？**

*   **原因**：直接使用 `dict[key]` 的方式访问，如果 `key` 不存在，Python 会抛出 `KeyError` 异常，这是一种明确的错误提示。
*   **安全处理方法**：
    1.  **使用 `get()` 方法**（推荐）：
        ```python
        value = my_dict.get("some_key", "默认值")
        ```
    2.  **先使用 `in` 关键字检查**：
        ```python
        if "some_key" in my_dict:
            value = my_dict["some_key"]
        else:
            value = "默认值"
        ```

**Q3：字典的键为什么不能是列表或字典？**

这源于哈希表的实现原理。字典需要通过计算键的 **哈希值** 来快速定位存储位置。为了计算哈希值，键必须是 **不可变** 的，因为如果键的内容变了，它的哈希值也应该变，但这会导致它在字典中“找不着自己”。列表和字典是 **可变** 对象，其内容可以随时改变，因此不能作为可靠的键。你可以使用 **元组** 来代替列表作为键。